import{P as g,S as T,F as y,R as w,A as O}from"./vendor-misc-CRXyoZRO.js";const _="2.93.2";let p="";typeof Deno<"u"?p="deno":typeof document<"u"?p="web":typeof navigator<"u"&&navigator.product==="ReactNative"?p="react-native":p="node";const A={"X-Client-Info":`supabase-js-${p}/${_}`},S={headers:A},U={schema:"public"},E={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},k={};function b(e){"@babel/helpers - typeof";return b=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},b(e)}function P(e,t){if(b(e)!="object"||!e)return e;var s=e[Symbol.toPrimitive];if(s!==void 0){var r=s.call(e,t);if(b(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function L(e){var t=P(e,"string");return b(t)=="symbol"?t:t+""}function C(e,t,s){return(t=L(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function m(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,r)}return s}function n(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?m(Object(s),!0).forEach(function(r){C(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):m(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}const D=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),j=()=>Headers,R=(e,t,s)=>{const r=D(s),c=j();return async(o,h)=>{var l;const a=(l=await t())!==null&&l!==void 0?l:e;let i=new c(h?.headers);return i.has("apikey")||i.set("apikey",e),i.has("Authorization")||i.set("Authorization",`Bearer ${a}`),r(o,n(n({},h),{},{headers:i}))}};function I(e){return e.endsWith("/")?e:e+"/"}function F(e,t){var s,r;const{db:c,auth:o,realtime:h,global:l}=e,{db:a,auth:i,realtime:u,global:d}=t,f={db:n(n({},a),c),auth:n(n({},i),o),realtime:n(n({},u),h),storage:{},global:n(n(n({},d),l),{},{headers:n(n({},(s=d?.headers)!==null&&s!==void 0?s:{}),(r=l?.headers)!==null&&r!==void 0?r:{})}),accessToken:async()=>""};return e.accessToken?f.accessToken=e.accessToken:delete f.accessToken,f}function N(e){const t=e?.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(I(t))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var $=class extends O{constructor(e){super(e)}},H=class{constructor(e,t,s){var r,c;this.supabaseUrl=e,this.supabaseKey=t;const o=N(e);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",o),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",o),this.storageUrl=new URL("storage/v1",o),this.functionsUrl=new URL("functions/v1",o);const h=`sb-${o.hostname.split(".")[0]}-auth-token`,l={db:U,realtime:k,auth:n(n({},E),{},{storageKey:h}),global:S},a=F(s??{},l);if(this.storageKey=(r=a.auth.storageKey)!==null&&r!==void 0?r:"",this.headers=(c=a.global.headers)!==null&&c!==void 0?c:{},a.accessToken)this.accessToken=a.accessToken,this.auth=new Proxy({},{get:(u,d)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(d)} is not possible`)}});else{var i;this.auth=this._initSupabaseAuthClient((i=a.auth)!==null&&i!==void 0?i:{},this.headers,a.global.fetch)}this.fetch=R(t,this._getAccessToken.bind(this),a.global.fetch),this.realtime=this._initRealtimeClient(n({headers:this.headers,accessToken:this._getAccessToken.bind(this)},a.realtime)),this.accessToken&&Promise.resolve(this.accessToken()).then(u=>this.realtime.setAuth(u)).catch(u=>console.warn("Failed to set initial Realtime auth token:",u)),this.rest=new g(new URL("rest/v1",o).href,{headers:this.headers,schema:a.db.schema,fetch:this.fetch}),this.storage=new T(this.storageUrl.href,this.headers,this.fetch,s?.storage),a.accessToken||this._listenForAuthEvents()}get functions(){return new y(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={head:!1,get:!1,count:void 0}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var e=this,t,s;if(e.accessToken)return await e.accessToken();const{data:r}=await e.auth.getSession();return(t=(s=r.session)===null||s===void 0?void 0:s.access_token)!==null&&t!==void 0?t:e.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:r,userStorage:c,storageKey:o,flowType:h,lock:l,debug:a,throwOnError:i},u,d){const f={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new $({url:this.authUrl.href,headers:n(n({},f),u),storageKey:o,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:r,userStorage:c,flowType:h,lock:l,debug:a,throwOnError:i,fetch:d,hasCustomAuthorizationHeader:Object.keys(this.headers).some(v=>v.toLowerCase()==="authorization")})}_initRealtimeClient(e){return new w(this.realtimeUrl.href,n(n({},e),{},{params:n(n({},{apikey:this.supabaseKey}),e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,"CLIENT",t?.access_token)})}_handleTokenChanged(e,t,s){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==s?(this.changedAccessToken=s,this.realtime.setAuth(s)):e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const G=(e,t,s)=>new H(e,t,s);function K(){if(typeof window<"u")return!1;const e=globalThis.process;if(!e)return!1;const t=e.version;if(t==null)return!1;const s=t.match(/^v(\d+)\./);return s?parseInt(s[1],10)<=18:!1}K()&&console.warn("⚠️  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");export{G as c};
