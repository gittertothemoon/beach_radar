import{r as s,j as e}from"./vendor-react-CVtZf1lr.js";import{S as r}from"./account-bn8wqSlT.js";import"./vendor-supabase-DxPc9Yn3.js";import"./vendor-misc-CRXyoZRO.js";const N=700,A=[{level:1,label:r.crowdLevels[1]},{level:2,label:r.crowdLevels[2]},{level:3,label:r.crowdLevels[3]},{level:4,label:r.crowdLevels[4]}],D=[{level:1,label:r.waterLevels[1]},{level:2,label:r.waterLevels[2]},{level:3,label:r.waterLevels[3]},{level:4,label:r.waterLevels[4]}],B=[{level:1,label:r.beachLevels[1]},{level:2,label:r.beachLevels[2]},{level:3,label:r.beachLevels[3]}],T=({isOpen:c,beachName:f,userLocation:a,distanceM:d,allowRemoteReports:b,geoStatus:t,geoError:_,onRequestLocation:h,onClose:p,onSubmit:E,submitError:y,submitting:o=!1})=>{const w=s.useRef(null),[x,S]=s.useState(null),[m,L]=s.useState(null),[v,C]=s.useState(null);s.useEffect(()=>{c&&!a&&t==="idle"&&h()},[t,c,h,a]),s.useEffect(()=>{if(!c)return;const l=w.current;if(!l)return;const n=l.querySelectorAll("button, [href], input, select, textarea, [tabindex]:not([tabindex='-1'])");n[0]?.focus();const g=i=>{if(i.key==="Escape"){p();return}if(i.key!=="Tab"||n.length===0)return;const k=n[0],j=n[n.length-1];i.shiftKey&&document.activeElement===k?(i.preventDefault(),j.focus()):!i.shiftKey&&document.activeElement===j&&(i.preventDefault(),k.focus())};return document.addEventListener("keydown",g),()=>document.removeEventListener("keydown",g)},[c,p]);const u=s.useMemo(()=>b?!0:!a||d===null?!1:d<=N,[b,d,a]);if(!c)return null;const z=()=>t==="loading"?r.report.locationSearching:b&&(t==="denied"||t==="error"||!a)?r.report.remoteAllowed:t==="denied"?r.report.locationDenied:t==="error"?_??r.report.locationUnavailable:a?d!==null&&d>N?b?r.report.remoteAllowed:r.report.tooFar:d!==null?r.report.nearEnough:"":r.report.locationRequired;return e.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center bg-black/40 px-4 pb-6 pt-10",children:e.jsxs("div",{ref:w,role:"dialog","aria-modal":"true","aria-label":r.aria.reportBeach(f),"data-testid":"report-modal",className:"w-full max-w-screen-sm rounded-[18px] contrast-guard px-6 pb-[calc(env(safe-area-inset-bottom)+20px)] pt-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold br-text-primary",children:r.report.title}),e.jsx("p",{className:"text-sm br-text-secondary",children:f})]}),e.jsx("button",{onClick:p,"aria-label":r.aria.closeReport,className:"br-press rounded-full border border-white/20 bg-black/40 px-3 py-1.5 text-xs font-semibold br-text-primary focus-visible:outline focus-visible:outline-1 focus-visible:outline-[color:var(--focus-ring)] focus-visible:outline-offset-1",children:r.actions.close})]}),e.jsx("div",{className:"mt-4 rounded-[12px] border border-white/15 bg-black/30 px-4 py-3 text-xs br-text-secondary backdrop-blur-sm",children:z()}),y?e.jsx("div",{"data-testid":"report-error",className:"mt-3 rounded-[12px] border border-rose-300/60 bg-rose-500/25 px-4 py-2 text-xs text-rose-50",children:y}):null,o?e.jsx("div",{className:"mt-3 rounded-[12px] border border-sky-300/60 bg-sky-500/20 px-4 py-2 text-xs text-sky-50",children:r.report.submitting}):null,e.jsxs("div",{className:"mt-5 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-[11px] font-semibold uppercase tracking-[0.12em] br-text-tertiary mb-2 text-center",children:["1. ",r.labels.crowdStatus," *"]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:A.map(l=>e.jsxs("button",{onClick:()=>S(l.level),disabled:!u||o,className:`br-press rounded-[10px] border px-2 py-2.5 text-[13px] font-medium transition disabled:cursor-not-allowed disabled:opacity-40 focus-visible:outline focus-visible:outline-1 focus-visible:outline-[color:var(--focus-ring)] focus-visible:outline-offset-1 ${x===l.level?"border-sky-300/60 bg-sky-500/20 text-sky-100 shadow-[0_0_15px_rgba(14,165,233,0.15)]":"border-white/15 bg-black/40 br-text-secondary hover:border-white/25 hover:bg-black/50"}`,children:[e.jsx("span",{className:"opacity-50 text-[11px] mr-1.5",children:l.level})," ",l.label]},l.level))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-[11px] font-semibold uppercase tracking-[0.12em] br-text-tertiary mb-2 text-center md:text-left",children:["2. ",r.labels.waterStatus," ",e.jsx("span",{className:"text-[10px] lowercase font-normal opacity-60",children:"(opzionale)"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:D.map(l=>e.jsx("button",{onClick:()=>L(l.level===m?null:l.level),disabled:!u||o,className:`br-press rounded-[10px] border px-2 py-2 text-[12px] font-medium transition disabled:cursor-not-allowed disabled:opacity-40 ${m===l.level?"border-emerald-300/60 bg-emerald-500/20 text-emerald-100 shadow-[0_0_15px_rgba(16,185,129,0.15)]":"border-white/10 bg-black/30 br-text-tertiary hover:border-white/20 hover:bg-black/40"}`,children:l.label},l.level))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-[11px] font-semibold uppercase tracking-[0.12em] br-text-tertiary mb-2 text-center md:text-left",children:["3. ",r.labels.beachStatus," ",e.jsx("span",{className:"text-[10px] lowercase font-normal opacity-60",children:"(opzionale)"})]}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:B.map(l=>e.jsx("button",{onClick:()=>C(l.level===v?null:l.level),disabled:!u||o,className:`br-press rounded-[10px] border px-2 py-2 text-[12px] font-medium transition disabled:cursor-not-allowed disabled:opacity-40 ${v===l.level?"border-amber-300/60 bg-amber-500/20 text-amber-100 shadow-[0_0_15px_rgba(245,158,11,0.15)]":"border-white/10 bg-black/30 br-text-tertiary hover:border-white/20 hover:bg-black/40"}`,children:l.label},l.level))})]})]}),e.jsx("button",{onClick:()=>x&&E(x,m??void 0,v??void 0),disabled:!x||!u||o,className:"br-press w-full rounded-[12px] border border-sky-300/60 bg-sky-500/30 px-4 py-3.5 text-[15px] font-semibold text-sky-50 shadow-[0_8px_20px_rgba(14,165,233,0.3)] backdrop-blur-sm transition hover:border-sky-300/80 hover:bg-sky-500/40 disabled:border-white/10 disabled:bg-white/5 disabled:text-white/30 disabled:shadow-none disabled:cursor-not-allowed mt-2",children:o?r.report.submitting:"Invia segnalazione"})]})]})})};export{T as default};
