import{S as u,i as oe,e as ne}from"./account-bn8wqSlT.js";import{t as Y,r as ae,i as se,c as re}from"./App-E8NZcKxx.js";import"./vendor-supabase-DxPc9Yn3.js";import"./vendor-misc-CRXyoZRO.js";import"./index-qWqqj5HS.js";import"./vendor-react-CVtZf1lr.js";import"./vendor-leaflet-KW0ACPqV.js";const le="/assets/sharecard-bg-DAIDWX3v.png",ie=t=>{switch(t){case"LIVE":return"#22c55e";case"RECENT":return"#f59e0b";default:return"#64748b"}},ce=t=>{switch(t){case 1:return"#22c55e";case 2:return"#facc15";case 3:return"#f97316";default:return"#ef4444"}},D=(t,s)=>{const o=t.replace("#",""),r=parseInt(o.slice(0,2),16),e=parseInt(o.slice(2,4),16),f=parseInt(o.slice(4,6),16);return`rgba(${r}, ${e}, ${f}, ${s})`},fe=t=>t.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)+/g,"").slice(0,40),de=t=>new Promise((s,o)=>{const r=new Image;r.onload=()=>s(r),r.onerror=()=>o(new Error(`Failed to load ${t}`)),r.src=t}),k=new Map,B=t=>{const s=k.get(t);if(s)return s;const o=de(t).catch(r=>{throw k.delete(t),r});return k.set(t,o),o},pe=()=>new Promise(t=>{if(typeof window>"u"){t();return}const s=window;if(typeof s.requestIdleCallback=="function"){s.requestIdleCallback(()=>t(),{timeout:250});return}window.setTimeout(t,0)}),he=(t,s,o,r)=>{const e=s.split(/\s+/).filter(Boolean),f=[];let l="";if(e.forEach(i=>{const m=l?`${l} ${i}`:i;if(t.measureText(m).width<=o){l=m;return}l&&f.push(l),l=i}),l&&f.push(l),f.length<=r)return f;const h=f.slice(0,r);let c=h[h.length-1];const p="â€¦";for(;t.measureText(`${c}${p}`).width>o&&c.length;)c=c.slice(0,-1);return h[h.length-1]=`${c}${p}`,h},ge=t=>{let s=t;return()=>{s+=1831565813;let o=Math.imul(s^s>>>15,1|s);return o^=o+Math.imul(o^o>>>7,61|o),((o^o>>>14)>>>0)/4294967296}},j=1080,F=1920,ue=async(t,s={})=>{const o=document.createElement("canvas"),r=typeof window<"u"?Math.min(window.devicePixelRatio||1,2):1;o.width=j*r,o.height=F*r;const e=o.getContext("2d");if(!e)throw new Error("Canvas not available");e.scale(r,r),await document.fonts?.ready;const[f,l]=await Promise.all([B(ne),B(le)]),h=(n,a,d,w,te)=>{const g=Math.min(te,d/2,w/2);e.beginPath(),e.moveTo(n+g,a),e.lineTo(n+d-g,a),e.quadraticCurveTo(n+d,a,n+d,a+g),e.lineTo(n+d,a+w-g),e.quadraticCurveTo(n+d,a+w,n+d-g,a+w),e.lineTo(n+g,a+w),e.quadraticCurveTo(n,a+w,n,a+w-g),e.lineTo(n,a+g),e.quadraticCurveTo(n,a,n+g,a),e.closePath()},c=j,p=F,i=48,m=c-i*2,L=Math.max(c/l.width,p/l.height),E=l.width*L,$=l.height*L,V=(c-E)/2,X=(p-$)/2;e.drawImage(l,V,X,E,$);const z=ge(12345),S=document.createElement("canvas");S.width=160,S.height=160;const C=S.getContext("2d");if(C){const n=C.createImageData(160,160);for(let a=0;a<n.data.length;a+=4){const d=Math.floor(z()*255);n.data[a]=d,n.data[a+1]=d,n.data[a+2]=d,n.data[a+3]=18}C.putImageData(n,0,0),e.globalAlpha=.06,e.drawImage(S,0,0,c,p),e.globalAlpha=1}const x=76,y=420,R=f.width/f.height*y,O=c/2;e.imageSmoothingEnabled=!0,e.imageSmoothingQuality="high",e.drawImage(f,O-R/2,x,R,y);const P=t.state==="PRED"?"STIMA":"LIVE";e.font="700 26px 'Space Grotesk', sans-serif";const q=e.measureText(P).width+36,Q=44,A=c-i-q,G=x+10,v=ie(t.state);e.fillStyle=D(v,.18),h(A,G,q,Q,22),e.fill(),e.strokeStyle=D(v,.5),e.lineWidth=2,e.stroke(),e.fillStyle=v,e.fillText(P,A+18,G+31),e.fillStyle="#f8fafc",e.font="700 68px 'Space Grotesk', sans-serif";const W=he(e,t.name,m,2),H=760,M=78;W.forEach((n,a)=>{e.fillText(n,i,H+a*M)});const U=H+W.length*M+18;e.fillStyle="rgba(226, 232, 240, 0.94)",e.font="500 35px 'Space Grotesk', sans-serif",e.fillText(t.region,i,U);const T=U+48,_=200;e.fillStyle="rgba(15, 23, 42, 0.72)",h(i,T,m,_,24),e.fill(),e.strokeStyle="rgba(255, 255, 255, 0.16)",e.lineWidth=1,e.stroke(),e.fillStyle="rgba(226, 232, 240, 0.74)",e.font="600 24px 'Space Grotesk', sans-serif",e.fillText(u.labels.crowdStatus.toUpperCase(),i+28,T+56);const J=re(t.crowdLevel)||u.labels.crowd;e.fillStyle=ce(t.crowdLevel),e.font="700 58px 'Space Grotesk', sans-serif",e.fillText(J.toUpperCase(),i+28,T+130,m-56);const K=T+_+56;e.fillStyle="rgba(226, 232, 240, 0.94)",e.font="500 36px 'Space Grotesk', sans-serif";const b=[];t.confidence&&b.push(`${u.share.confidenceLabel}: ${t.confidence}`),t.updatedLabel&&b.push(`${u.share.updatedLabel}: ${t.updatedLabel}`),t.reportsCount>0?b.push(`${u.share.reportsLabel}: ${t.reportsCount}`):b.push(u.reports.noneRecent),b.forEach((n,a)=>{e.fillText(n,i,K+a*48)});const N=132,I=p-i-N;e.fillStyle="rgba(12, 18, 30, 0.82)",h(i,I,m,N,20),e.fill(),e.strokeStyle="rgba(255, 255, 255, 0.2)",e.lineWidth=1,e.stroke(),e.fillStyle="rgba(226, 232, 240, 0.9)",e.font="500 26px 'Space Grotesk', sans-serif",e.fillText("Apri questa spiaggia su",i+20,I+48),e.fillStyle="rgba(226, 232, 240, 0.96)",e.font="600 26px 'Space Grotesk', sans-serif",e.fillText(oe,i+20,I+88);const Z=s.mimeType??"image/jpeg",ee=s.quality??.9;return new Promise((n,a)=>{o.toBlob(d=>{d?n(d):a(new Error("Failed to export card"))},Z,ee)})},Ie=async t=>{Y("share_card_generate");const s="image/jpeg";await pe();const o=se(),r=o?performance.now():0,e=await ue(t,{mimeType:s,quality:.9});o&&ae("share_card_render",performance.now()-r);const f=`where2beach-${fe(t.name)}.jpg`,l=new File([e],f,{type:s}),h=typeof navigator<"u"&&"canShare"in navigator&&navigator.canShare?.({files:[l]});if(navigator.share&&h){await navigator.share({title:u.appName,text:u.share.shareText(t.name,t.confidence),files:[l]});return}Y("share_card_download");const c=URL.createObjectURL(e),p=document.createElement("a");p.href=c,p.download=f,document.body.appendChild(p),p.click(),p.remove(),URL.revokeObjectURL(c)};export{Ie as shareBeachCard};
