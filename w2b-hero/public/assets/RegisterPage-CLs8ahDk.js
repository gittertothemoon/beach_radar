import{r as n,j as o}from"./vendor-react-CVtZf1lr.js";import{P as K,S as e,e as Q,r as V,u as X,f as ee,h as te,b as oe}from"./account-bn8wqSlT.js";import"./vendor-supabase-DxPc9Yn3.js";import"./vendor-misc-CRXyoZRO.js";const C=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,E=/^[A-Za-zÀ-ÖØ-öø-ÿ' -]{2,}$/,se=/[A-Z]/,re=/[a-z]/,ae=/\d/,ne=/[^A-Za-z0-9]/,ce=10,me=()=>{const[w,F]=n.useState(""),[v,q]=n.useState(""),[f,U]=n.useState(""),[i,T]=n.useState(""),[b,I]=n.useState(""),[y,B]=n.useState(!1),[N,k]=n.useState(!1),[P,s]=n.useState(null),[j,d]=n.useState(null),p=n.useMemo(()=>new URLSearchParams(window.location.search),[]),g=p.get("mode"),h=g==="login"||g==="forgot"||g==="reset"?g:"register",x=h==="register",m=h==="login",u=h==="forgot",c=h==="reset",S=p.get("returnTo")||"/",_=p.get("fav"),R=p.get("beachName"),A=n.useMemo(()=>{const t=new URL(S,window.location.origin),r=t.pathname.replace(/\/+$/,"")||"/";return r==="/register"||r==="/app/register"?r.startsWith("/app")?"/app":"/":`${t.pathname}${t.search}${t.hash}`},[S]),Y=n.useMemo(()=>{const t=new URLSearchParams(window.location.search);t.delete("mode");const r=t.toString();return`${window.location.pathname}${r?`?${r}`:""}${window.location.hash}`},[]),L=n.useMemo(()=>{const t=new URLSearchParams(window.location.search);t.set("mode","login");const r=t.toString();return`${window.location.pathname}${r?`?${r}`:""}${window.location.hash}`},[]),M=n.useMemo(()=>{const t=new URLSearchParams(window.location.search);t.set("mode","forgot");const r=t.toString();return`${window.location.pathname}${r?`?${r}`:""}${window.location.hash}`},[]),z=n.useMemo(()=>{const t=new URLSearchParams(window.location.search);t.set("mode","reset"),t.delete("error"),t.delete("error_code"),t.delete("error_description");const r=t.toString();return`${window.location.origin}${window.location.pathname}${r?`?${r}`:""}`},[]),H=n.useMemo(()=>{const t=new URL("/privacy/",K),l=p.get("lang")==="en"?"en":"it";t.searchParams.set("lang",l),t.searchParams.set("from","app");const a=`${window.location.pathname}${window.location.search}${window.location.hash}`;return t.searchParams.set("back",a),t.toString()},[p]);n.useEffect(()=>{const t=document.getElementById("root"),r=document.body.style.overflow,l=document.body.style.overflowY,a=t?.style.overflow,J=t?.style.overflowY;return document.body.style.overflow="auto",document.body.style.overflowY="auto",t&&(t.style.overflow="auto",t.style.overflowY="auto"),()=>{document.body.style.overflow=r,document.body.style.overflowY=l,t&&(t.style.overflow=a??"",t.style.overflowY=J??"")}},[]),n.useEffect(()=>{if(!c)return;const t=new URLSearchParams(window.location.search);(t.get("error_description")??t.get("error"))&&s(e.account.resetPasswordInvalidLink)},[c]);const $=n.useMemo(()=>i.length>=ce&&se.test(i)&&re.test(i)&&ae.test(i)&&ne.test(i),[i]),O=()=>{const t=w.trim(),r=v.trim(),l=f.trim().toLowerCase();return u?l.length===0?e.account.requiredField:C.test(l)?null:e.account.invalidEmail:c?i.length===0||b.length===0?e.account.requiredField:$?i!==b?e.account.passwordMismatch:null:e.account.weakPassword:l.length===0||i.length===0?e.account.requiredField:C.test(l)?m?null:t.length===0||r.length===0||b.length===0?e.account.requiredField:!E.test(t)||!E.test(r)?e.account.invalidName:$?i!==b?e.account.passwordMismatch:y?null:e.account.consentRequired:e.account.weakPassword:e.account.invalidEmail},D=m?e.account.signInTitle:u?e.account.forgotPasswordTitle:c?e.account.resetPasswordTitle:e.account.registerTitle,W=m?e.account.signInSubtitle:u?e.account.forgotPasswordSubtitle:c?e.account.resetPasswordSubtitle:e.account.registerSubtitle,Z=N?m?e.account.signingInAction:u?e.account.forgotPasswordSubmittingAction:c?e.account.resettingPasswordAction:e.account.creatingAction:m?e.account.signInSubmitAction:u?e.account.forgotPasswordSubmitAction:c?e.account.resetPasswordSubmitAction:e.account.createAction,G=async()=>{const t=O();if(t){d(null),s(t);return}k(!0),s(null),d(null);try{if(u){const a=await V({email:f,redirectTo:z});if(!a.ok)switch(a.code){case"missing_config":s(e.account.createMissingConfig);return;case"invalid_email":s(e.account.invalidEmail);return;default:s(e.account.resetPasswordRequestFailed);return}d(e.account.forgotPasswordSent);return}let r=null;if(c){const a=await X(i);if(!a.ok)switch(a.code){case"missing_config":s(e.account.createMissingConfig);return;case"unauthorized":s(e.account.resetPasswordInvalidLink);return;case"weak_password":s(e.account.weakPassword);return;default:s(e.account.resetPasswordFailed);return}r=a.account.id}else if(m){const a=await ee({email:f,password:i});if(!a.ok){if(a.code==="missing_config"){s(e.account.createMissingConfig);return}if(a.code==="invalid_credentials"){s(e.account.invalidCredentials);return}s(e.account.createFailed);return}if(!a.sessionReady){s(e.account.emailConfirmationRequired);return}r=a.account.id}else{const a=await te({firstName:w,lastName:v,email:f.trim().toLowerCase(),password:i});if(!a.ok)switch(a.code){case"missing_config":s(e.account.createMissingConfig);return;case"email_exists":s(e.account.emailAlreadyRegistered);return;case"weak_password":s(e.account.weakPassword);return;case"invalid_email":s(e.account.invalidEmail);return;default:s(e.account.createFailed);return}if(!a.sessionReady){s(e.account.emailConfirmationRequired);return}r=a.account.id}if(_&&r&&!(await oe(r,_,!0)).ok){s(e.account.favoriteSyncFailed);return}c&&d(e.account.resetPasswordSuccess);const l=new URL(A,window.location.origin);l.searchParams.set("resume","1"),window.location.assign(`${l.pathname}${l.search}${l.hash}`)}catch{s(u?e.account.resetPasswordRequestFailed:c?e.account.resetPasswordFailed:e.account.createFailed)}finally{k(!1)}};return o.jsx("div",{className:"min-h-screen min-h-[100dvh] bg-[radial-gradient(1100px_600px_at_12%_-8%,rgba(56,189,248,0.14),transparent_55%),radial-gradient(900px_500px_at_95%_12%,rgba(251,191,36,0.12),transparent_58%),linear-gradient(160deg,#07090d_0%,#0b0f16_70%,#0f1720_100%)] px-3 py-[calc(env(safe-area-inset-top)+10px)] text-slate-100 sm:px-4 sm:py-[calc(env(safe-area-inset-top)+20px)]",children:o.jsx("div",{className:"mx-auto flex h-full w-full max-w-screen-sm items-start sm:items-center",children:o.jsx("div",{className:"contrast-guard max-h-[94dvh] w-full overflow-y-auto overflow-x-hidden rounded-[18px] border border-white/15 px-4 pb-[calc(env(safe-area-inset-bottom)+12px)] pt-4 shadow-[0_18px_44px_rgba(0,0,0,0.42)] sm:max-h-[92svh] sm:px-5 sm:pb-[calc(env(safe-area-inset-bottom)+16px)] sm:pt-5",children:o.jsxs("div",{className:"flex flex-col",children:[o.jsx("div",{className:"flex shrink-0 flex-col items-center",children:o.jsx("img",{src:Q,alt:e.appName,className:"h-auto w-24 drop-shadow-[0_10px_24px_rgba(0,0,0,0.45)] sm:w-28"})}),o.jsxs("div",{className:"mt-3 flex flex-wrap items-end justify-between gap-x-2.5 gap-y-1.5",children:[o.jsx("h1",{className:"text-[22px] font-semibold tracking-[-0.015em] br-text-primary sm:text-[24px]",children:D}),R&&!u&&!c?o.jsx("div",{className:"max-w-full shrink-0 truncate rounded-full border border-amber-300/45 bg-amber-400/12 px-2 py-0.5 text-[10px] font-semibold text-amber-100",children:R}):null]}),o.jsx("p",{className:"mt-2 text-[13px] leading-snug br-text-secondary",children:W}),o.jsxs("div",{className:"mt-4 grid grid-cols-1 gap-x-2.5 gap-y-3.5 min-[390px]:grid-cols-2",children:[x?o.jsxs("label",{className:"block",children:[o.jsx("span",{className:"text-[10px] font-semibold uppercase tracking-[0.09em] br-text-tertiary",children:e.account.firstNameLabel}),o.jsx("input",{type:"text",value:w,onChange:t=>{F(t.target.value),s(null),d(null)},placeholder:e.account.firstNamePlaceholder,className:"mt-2 w-full rounded-[10px] border border-white/20 bg-black/40 px-3 py-2.5 text-[14px] br-text-primary placeholder:text-[color:var(--text-tertiary)] focus-visible:outline focus-visible:outline-1 focus-visible:outline-[color:var(--focus-ring)] focus-visible:outline-offset-1",autoFocus:!0})]}):null,x?o.jsxs("label",{className:"block",children:[o.jsx("span",{className:"text-[10px] font-semibold uppercase tracking-[0.09em] br-text-tertiary",children:e.account.lastNameLabel}),o.jsx("input",{type:"text",value:v,onChange:t=>{q(t.target.value),s(null),d(null)},placeholder:e.account.lastNamePlaceholder,className:"mt-2 w-full rounded-[10px] border border-white/20 bg-black/40 px-3 py-2.5 text-[14px] br-text-primary placeholder:text-[color:var(--text-tertiary)] focus-visible:outline focus-visible:outline-1 focus-visible:outline-[color:var(--focus-ring)] focus-visible:outline-offset-1"})]}):null,c?null:o.jsxs("label",{className:"col-span-full block",children:[o.jsx("span",{className:"text-[10px] font-semibold uppercase tracking-[0.09em] br-text-tertiary",children:e.account.emailLabel}),o.jsx("input",{"data-testid":"auth-email-input",type:"email",value:f,onChange:t=>{U(t.target.value),s(null),d(null)},placeholder:e.account.emailPlaceholder,className:"mt-2 w-full rounded-[10px] border border-white/20 bg-black/40 px-3 py-2.5 text-[14px] br-text-primary placeholder:text-[color:var(--text-tertiary)] focus-visible:outline focus-visible:outline-1 focus-visible:outline-[color:var(--focus-ring)] focus-visible:outline-offset-1",autoFocus:m||u})]}),u?null:o.jsxs("label",{className:m?"col-span-full block":"block",children:[o.jsx("span",{className:"text-[10px] font-semibold uppercase tracking-[0.09em] br-text-tertiary",children:e.account.passwordLabel}),o.jsx("input",{"data-testid":"auth-password-input",type:"password",value:i,onChange:t=>{T(t.target.value),s(null),d(null)},placeholder:e.account.passwordPlaceholder,className:"mt-2 w-full rounded-[10px] border border-white/20 bg-black/40 px-3 py-2.5 text-[14px] br-text-primary placeholder:text-[color:var(--text-tertiary)] focus-visible:outline focus-visible:outline-1 focus-visible:outline-[color:var(--focus-ring)] focus-visible:outline-offset-1",autoFocus:c})]}),x||c?o.jsxs("label",{className:"block",children:[o.jsx("span",{className:"text-[10px] font-semibold uppercase tracking-[0.09em] br-text-tertiary",children:e.account.confirmPasswordLabel}),o.jsx("input",{type:"password",value:b,onChange:t=>{I(t.target.value),s(null),d(null)},placeholder:e.account.confirmPasswordPlaceholder,className:"mt-2 w-full rounded-[10px] border border-white/20 bg-black/40 px-3 py-2.5 text-[14px] br-text-primary placeholder:text-[color:var(--text-tertiary)] focus-visible:outline focus-visible:outline-1 focus-visible:outline-[color:var(--focus-ring)] focus-visible:outline-offset-1"})]}):null,x||c?o.jsx("div",{className:"col-span-full rounded-[10px] border border-white/12 bg-black/30 px-3 py-2.5 text-[11px] leading-snug br-text-tertiary",children:e.account.passwordHint}):null,x?o.jsxs("label",{className:"col-span-full flex items-start gap-2.5 rounded-[10px] border border-white/12 bg-black/30 px-3 py-2.5 text-[12px] leading-snug br-text-secondary",children:[o.jsx("input",{type:"checkbox",checked:y,onChange:t=>{B(t.target.checked),s(null),d(null)},className:"mt-[1px] h-4 w-4 shrink-0 accent-sky-400"}),o.jsxs("span",{children:[e.account.consentLabel," ",o.jsx("a",{href:H,className:"font-semibold underline-offset-2 hover:underline",children:"Privacy"})]})]}):null]}),P?o.jsx("div",{className:"mt-3.5 rounded-[10px] border border-rose-300/60 bg-rose-500/25 px-3 py-2.5 text-[12px] text-rose-50",children:P}):null,j?o.jsx("div",{className:"mt-3.5 rounded-[10px] border border-emerald-300/45 bg-emerald-500/15 px-3 py-2.5 text-[12px] text-emerald-50",children:j}):null,o.jsxs("div",{className:"mt-5 space-y-3 border-t border-white/8 pt-4",children:[o.jsx("button",{type:"button",disabled:N,"data-testid":"auth-submit",onClick:()=>{G()},className:"br-press w-full rounded-[10px] border border-white/25 bg-black/50 px-3 py-3.5 text-[14px] font-semibold text-slate-50 shadow-[0_8px_20px_rgba(0,0,0,0.42)] backdrop-blur-sm focus-visible:outline focus-visible:outline-1 focus-visible:outline-[color:var(--focus-ring)] focus-visible:outline-offset-1 disabled:cursor-not-allowed disabled:opacity-60",children:Z}),o.jsx("button",{type:"button",onClick:()=>{if(u||c){window.location.assign(L);return}window.location.assign(A)},className:"br-press w-full rounded-[10px] border border-white/16 bg-black/35 px-3 py-3.5 text-[14px] font-semibold br-text-primary backdrop-blur-sm focus-visible:outline focus-visible:outline-1 focus-visible:outline-[color:var(--focus-ring)] focus-visible:outline-offset-1",children:u||c?e.account.backToLoginAction:e.account.cancelAndBack}),m?o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"rounded-[10px] border border-white/12 bg-black/25 px-3 py-3 text-center",children:o.jsxs("p",{className:"text-[12px] leading-snug br-text-secondary",children:[e.account.forgotPasswordPrompt," ",o.jsx("button",{type:"button",onClick:()=>{window.location.assign(M)},className:"font-semibold text-sky-200 underline decoration-sky-200/70 underline-offset-2 transition-colors hover:text-sky-100",children:e.account.forgotPasswordAction})]})}),o.jsx("div",{className:"rounded-[10px] border border-white/12 bg-black/25 px-3 py-3 text-center",children:o.jsxs("p",{className:"text-[12px] leading-snug br-text-secondary",children:[e.account.signInNoAccountPrompt," ",o.jsx("button",{type:"button",onClick:()=>{window.location.assign(Y)},className:"font-semibold text-sky-200 underline decoration-sky-200/70 underline-offset-2 transition-colors hover:text-sky-100",children:e.account.signInNoAccountAction})]})})]}):null,x?o.jsx("div",{className:"rounded-[10px] border border-white/12 bg-black/25 px-3 py-3 text-center",children:o.jsxs("p",{className:"text-[12px] leading-snug br-text-secondary",children:[e.account.registerHasAccountPrompt," ",o.jsx("button",{type:"button",onClick:()=>{window.location.assign(L)},className:"font-semibold text-sky-200 underline decoration-sky-200/70 underline-offset-2 transition-colors hover:text-sky-100",children:e.account.registerHasAccountAction})]})}):null,c?o.jsx("div",{className:"rounded-[10px] border border-white/12 bg-black/25 px-3 py-3 text-center",children:o.jsxs("p",{className:"text-[12px] leading-snug br-text-secondary",children:[e.account.resetPasswordRequestAgainPrompt," ",o.jsx("button",{type:"button",onClick:()=>{window.location.assign(M)},className:"font-semibold text-sky-200 underline decoration-sky-200/70 underline-offset-2 transition-colors hover:text-sky-100",children:e.account.resetPasswordRequestAgainAction})]})}):null]})]})})})})};export{me as default};
